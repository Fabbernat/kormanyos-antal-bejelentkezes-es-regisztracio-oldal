<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <title>Saját oldal</title>
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <header>
    <h1>Üdvözöllek az oldalamon</h1>
    <nav>
      <ul>
        <li><a href="index.html">Főoldal</a></li>
        <li><a href="signup.html">Regisztráció</a></li>
        <li><a href="login.html">Bejelentkezés</a></li>
        <li><a href="../js/logout.js">Kijelentkezés</a></li>
      </ul>
    </nav>
  </header>

  <main id="page">
    <div style="margin: auto; width: 50%; text-align: center">
      <h1>Regisztráció</h1>
      <form id="registrationForm" action="#" method="POST" enctype="multipart/form-data" name="registrationForm"
        onsubmit="return validateForm(event)">
        <fieldset>
          <legend>Regisztrációs adatok</legend>
          <label>Teljes név: <br><input type="text" name="full-name" size="25" required />
          </label> <br />
          <label>
            Felhasználónév: <br><input type="text" name="username" required />
          </label> <br />
          <label>
            Jelszó: <br><input type="password" name="password" required />
          </label> <br />
          <label>
            Jelszó ismét: <br><input type="password" name="password-check" required />
          </label> <br />
          <label>
            E-mail: <br><input type="email" name="email" required />
          </label> <br />
          <input type="reset" name="reset-btn" value="Törlés" />
          <input type="submit" name="signup-submit-btn" value="Regisztráció" />
        </fieldset>
      </form>
      <hr>
      <div id="message"></div>
      <hr>
    </div>
    <div style="margin: auto; width: 50%; text-align: center">
      <a href="login.html">Már van fiókod? Jelentkezz be itt!</a>
    </div>
  </main>
  <script>
    const dummySignupDataToAccept = {
      "test": "test",
      "admin": "123456",
      "user": "1234"
    };

    const uzenet = "Üdvözöllek az oldalamon!";
    document.getElementById("message").innerText = uzenet;

    function validateForm(event) {
      event.preventDefault();

      let fullName = document.forms["registrationForm"]["full-name"].value;
      let username = document.forms["registrationForm"]["username"].value;
      let password = document.forms["registrationForm"]["password"].value;
      let passwordCheck = document.forms["registrationForm"]["password-check"].value;
      let email = document.forms["registrationForm"]["email"].value;

      if (username in dummySignupDataToAccept) {
        messageBox.style.color = "green";
        messageBox.innerHTML = "Sikeres teszt regisztráció!";
        return true;
      }

      let errors = [];

      if (fullName === "") {
        errors.push("A teljes név megadása kötelező!");
      }

      if (username === "") {
        errors.push("A felhasználónév megadása kötelező!");
      }

      if (password === "" || passwordCheck === "") {
        errors.push("A jelszó és az ellenőrző jelszó megadása kötelező!");
      } else if (password !== passwordCheck) {
        errors.push("A jelszó és az ellenőrző jelszó nem egyezik!");
      }

      if (email === "") {
        errors.push("Az email-cím megadása kötelező!");
      } else if (!isValidEmail(email)) {
        errors.push("Az email-cím formátuma helytelen!");
      }

      const messageBox = document.getElementById("message");
      messageBox.innerHTML = "";

      if (errors.length > 0) {
        messageBox.style.color = "red";
        messageBox.innerHTML = errors.join("<br>");
        return false;
      }

      // ---- "save" the user (localStorage version) ----
      let users = JSON.parse(localStorage.getItem("users") || "[]");
      users.push({ fullName, username, password, email });
      localStorage.setItem("users", JSON.stringify(users));

      messageBox.style.color = "green";
      messageBox.innerHTML = "Sikeres regisztráció!";
      return true;
    }

    function isValidEmail(email) {
      let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    document.getElementById("registrationForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const fullName = e.target["full-name"].value.trim();
      const username = e.target["username"].value.trim();
      const password = e.target["password"].value.trim();
      const email = e.target["email"].value.trim();

      try {
        const response = await fetch("/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fullName, username, password, email }),
        });

        const data = await response.json();
        document.getElementById("message").innerText = data.message || data.error;
      } catch (error) {
        console.error("Hiba:", error);
      }
    });
  </script>
</body>

</html>