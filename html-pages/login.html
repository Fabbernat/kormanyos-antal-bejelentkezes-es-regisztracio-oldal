<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8" />
    <title>Saját oldal</title>
    <link rel="stylesheet" href="../css/style.css" />
</head>

<body>
    <header>
        <h1>Üdvözöllek az oldalamon</h1>
        <nav>
            <ul>
                <li><a href="index.html">Főoldal</a></li>
                <li><a href="signup.html">Regisztráció</a></li>
                <li><a href="login.html">Bejelentkezés</a></li>
                <li><a href="../js/logout.js">Kijelentkezés</a></li>
            </ul>
        </nav>
    </header>

    <main id="page">
        <div style="margin: auto; width: 50%; text-align: center">
            <h1>Bejelentkezés</h1>
            <form id="loginForm" action="#" method="POST" enctype="multipart/form-data" name="loginForm"
                onsubmit="return validateForm(event)">
                <fieldset>
                    <legend>Bejelentkezés adatok</legend>
                    <label>
                        Felhasználónév: <br />
                        <input type="text" name="felhasznalonev" />
                    </label><br />
                    <label>
                        Jelszó: <br />
                        <input type="password" name="jelszo" />
                    </label><br />
                    <input type="reset" name="reset-btn" value="Törlés" />
                    <input type="submit" name="login-submit-btn" value="Bejelentkezés" />
                </fieldset>
            </form>
            <hr>
            <div id="message"></div>
            <hr>
        </div>
        <div style="margin: auto; width: 50%; text-align: center">
            <a href="signup.html">Nincs még fiókod? Regisztrálj itt!</a>
        </div>
    </main>
    <script>
        const dummyLoginDataToAccept = {
            "test": "test",
            "admin": "123456",
            "user": "1234"
        };

        const uzenet = "Üdvözöllek az oldalamon!";
        document.getElementById("message").innerText = uzenet;

        function validateForm(event) {
            event.preventDefault();

            let fullName = document.forms["registrationForm"]["full-name"].value;
            let username = document.forms["registrationForm"]["username"].value;
            let password = document.forms["registrationForm"]["password"].value;
            let passwordCheck = document.forms["registrationForm"]["password-check"].value;
            let email = document.forms["registrationForm"]["email"].value;

            if (username in dummySignupDataToAccept) {
                messageBox.style.color = "green";
                messageBox.innerHTML = "Sikeres teszt regisztráció!";
                return true;
            }

            let errors = [];

            if (fullName === "") {
                errors.push("A teljes név megadása kötelező!");
            }

            if (username === "") {
                errors.push("A felhasználónév megadása kötelező!");
            }

            if (password === "" || passwordCheck === "") {
                errors.push("A jelszó és az ellenőrző jelszó megadása kötelező!");
            } else if (password !== passwordCheck) {
                errors.push("A jelszó és az ellenőrző jelszó nem egyezik!");
            }

            if (email === "") {
                errors.push("Az email-cím megadása kötelező!");
            } else if (!isValidEmail(email)) {
                errors.push("Az email-cím formátuma helytelen!");
            }

            const messageBox = document.getElementById("message");
            messageBox.innerHTML = "";

            if (errors.length > 0) {
                messageBox.style.color = "red";
                messageBox.innerHTML = errors.join("<br>");
                return false;
            }

            // ---- "save" the user (localStorage version) ----
            let users = JSON.parse(localStorage.getItem("users") || "[]");
            users.push({ fullName, username, password, email });
            localStorage.setItem("users", JSON.stringify(users));

            messageBox.style.color = "green";
            messageBox.innerHTML = "Sikeres regisztráció!";
            return true;
        }

        function isValidEmail(email) {
            let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const felhasznalonev = e.target["username"].value.trim();
            const jelszo = e.target["password"].value.trim();

            // users.json betöltése
            let fiokok = {};
            fetch("json/users.json")
                .then(r => r.json())
                .then(data => { fiokok = data; });

            try {
                const response = await fetch('json/users.json');
                if (!response.ok) {
                    throw new Error('Hálózati hiba a users.json betöltésekor');
                }

                const data = await response.json();
                document.getElementById("message").innerText = data.message || data.error;
            } catch (error) {
                console.error("Hiba:", error);
            }
        });
    </script>
</body>

</html>