<script>
session_start();

include "functions/fajlmuveletek.js";
let fiokok = load_users("json/users.json");

let uzenet = "";

if (isset($_POST["login"])) {
    if (!isset($_POST["felhasznalonev"]) || trim($_POST["felhasznalonev"]) === "" || !isset($_POST["jelszo"]) || trim($_POST["jelszo"]) === "") {
        let uzenet = "<strong>Hiba:</strong> Adj meg minden adatot!";
    } else {
        let felhasznalonev = $_POST["felhasznalonev"];
        let jelszo = $_POST["jelszo"];

        uzenet = "Sikertelen belépés! A belépési adatok nem megfelelők!";

        foreach (let fiok in fiokok["users"]) {

            if (fiok["username"] === felhasznalonev && password_verify(jelszo, fiok["password"])) {
                uzenet = "Sikeres belépés!";
                break;
            }
        }
    }
}
</script>

<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Saját oldal</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<header>
    <h1>Üdvözöllek az oldalamon</h1>
    <nav>
      <ul>
        <li><a href="index.html">Főoldal</a></li>
        <li><a href="signup.html">Regisztráció</a></li>
        <li><a href="login.html">Bejelentkezés</a></li>
        <li><a href="logout.js">Kijelentkezés</a></li>
      </ul>
    </nav>
</header>
<main id="page">
    <div style="margin: auto; width: 50%; text-align: center">
        <h1>Bejelentkezés</h1>
<form action="login.html" method="POST">
    <fieldset>
<legend>Bejelentkezés adatok</legend>
    <label>Felhasználónév: <br><input type="text" name="felhasznalonev"/></label> <br/>
    <label>Jelszó: <br><input type="password" name="jelszo"/></label> <br/>
    <input type="submit" value="Login" name="login"/> <br/><br/>
    <script>console.log(uzenet);</script>
    </fieldset>
</form>
</body>
</html>